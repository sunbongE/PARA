{% extends 'base.html' %}
{% load static %}
{% load custom_tags %}
{% load i18n %}


{% block body %}
    <div class="container">
        <div class="row" style="margin-top: 6%">
        <h2>{% trans '장바구니' %}
            <span class="">
                {% with totail_items=cart|length %}
                :{{ totail_items }}개
                    {% if cart|length > 0 %}
                        {% comment %} {% trans 'My Shopping Order:' %}
                        <a href="{% url "cart:cart_detail" %}">
                            {{ totail_items }} {% trans 'item' %} {{ totail_items|pluralize }}, {{ cart.get_total_price|price_view }}
                        </a>
                        {% else %}
                        {% trans 'Your cart is empty.' %} {% endcomment %}
                    {% endif %}
                {% endwith %}
            </span>
        </h2>
            <table class="table table-striped table-hover">
                <thead class="bg-success p-2 text-dark bg-opacity-25">
                    <tr>
                        <th>{% trans '상품 이미지' %}</th>
                        <th>{% trans '상품명' %}</th>
                        <th>{% trans '수량' %}</th>
                        <th>{% trans '주문 관리' %}</th>
                        <th>{% trans '판매가' %}</th>
                        <th>{% trans '주문 금액' %}</th>
                    </tr>
                </thead>
                <tbody>
                {% for item in cart %}
                    {% with product=item.product %}
                        <tr>
                            {% for img in images %}
                            {% if img.product_id == product.id %}
                            <td>
                                <a href="{% url 'products:detail' product.id %}">
                                    <img src="{{ img.product_image }}" style="height: 130px; width: auto"> 
                                </a>                  
                            </td>
                            {% endif %}
                            {% endfor %}
                            <td>
                                <a href="{% url 'products:detail' product.id %}" class="text-decoration-none">
                                    {{ product.name }}
                                </a>
                            </td>
                            <td>
                                <form action="{% url "cart:cart_add" product.id %}" method="post" class="form-inline">
                                    {% csrf_token %}
                                    {{ item.update_quantity_form.quantity }}
                                    {{ item.update_quantity_form.update }}
                                    <input type="submit" value="수정" class="btn btn-success"></span>
                                </form>
                            </td>
                            <td>
                                <a href="{% url "cart:cart_remove" product.id %}">
                                    <button class="btn btn-danger">삭제</button>
                                </a>
                            </td>
                            <td>{{ item.price|price_view }}</td>
                            <td>{{ item.total_price|price_view }}</td>
                        </tr>
                    {% endwith %}
                {% endfor %}
                <tr class="bg-success p-2 text-dark bg-opacity-25">
                    <td><b>{% trans '총 금액:' %}</b></td>
                    <td colspan="4"></td>
                    <td colspan="num"><b>{{ cart.get_total_price|price_view }}</b></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}